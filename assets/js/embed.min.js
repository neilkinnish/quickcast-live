$(function(){$("video").quickCastPlayer()}),function(e){e.fn.quickCastPlayer=function(){var t=e("video").attr("data-width"),n=e("video").attr("data-height"),i=parseFloat(t/n);if(/mobile/i.test(navigator.userAgent)){var s=e("body").width();return e("video").attr("controls",!0).attr("width",s).attr("height",s/i.toFixed(2)),e(window).resize(function(){var t=e("body").width();e("video").attr("width",t).attr("height",t/i.toFixed(2))}),e("video").css({"max-width":"100%"}),void 0}return this.each(function(){var t=e(this)[0];if(/chrome|firefox|opera/i.test(navigator.userAgent)){var n=e(this).find("source[type='video/webm']");e(this).children().remove(),e(this).append(n)}else{var n=e(this).find("source[type='video/mp4']");/-small.mp4/i.test(n.src)&&(n.src=n.src.replace("-small.mp4",".mp4")),e(this).children().remove(),e(this).append(n)}t.addEventListener("loadeddata",function(){function t(){p.currentTime>=l&&(p.currentTime=0),y=d.find(".progress").width(),x(),d.find(".progress-bar").css({width:g+"px"});var e=g-d.find(".progress-button").width();0>e&&(e=0),d.find(".progress-button").css({left:e+"px"}),w()}var n=e(this),i=n.attr("data-width"),s=n.attr("data-height"),a=n.attr("data-intro"),r=n.attr("data-outro"),o=!1;300>=i||300>=s?(o=!0,n.wrap('<div class="video micro"></div>')):n.wrap('<div class="video"></div>'),o===!1&&""!=a&&e(".play-button").append("<div><span>"+a+"</span></div>");var d=n.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="progress-button"> </div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"><a href="#"> </a></div><div class="link"><a href="#"> </a></div></div>').appendTo(d),d.bind("selectstart",function(){return!1});var u,p=e(this)[0],l=p.duration,c=document.title,f=!1,v=!1,m=!1,h=!1,b=0,g=0,y=d.find(".progress").width(),w=function(){var t=p.buffered;if(d.find("[class^=buffered]").remove(),t.length>0)for(var n=t.length;n--;){$maxBuffer=t.end(n),$minBuffer=t.start(n);var i=100*($minBuffer/l),s=100*(($maxBuffer-$minBuffer)/l);e('<div class="buffered"></div>').css({left:i+"%",width:s+"%"}).appendTo(d.find(".progress"))}};w();var x=function(){var t=Math.round(e(".progress-bar").width()/y*l),n=p.currentTime,i=0,s=Math.floor(t/60),r=Math.floor(l/60),u=Math.round(l-60*r);t&&(i=Math.round(t)-60*s,i>59&&(i=Math.round(t)-60*s,60==i&&(s=Math.round(t/60),i=0))),g=n/l*y,10>i&&(i="0"+i),10>u&&(u="0"+u),d.find(".progress-bar").css({width:g+"px"});var f=g-d.find(".progress-button").width();0>f&&(f=0),d.find(".progress-button").css({left:f+"px"}),d.find(".ctime").html(s+":"+i),d.find(".ttime").html(r+":"+u),p.currentTime>0&&0==p.paused&&0==p.ended&&w(),document.title=m?"Playing "+s+":"+i+" / "+r+":"+u:p.currentTime>0?"Paused "+s+":"+i+" / "+r+":"+u:c,o===!1&&0>=n&&""!=a&&(0===e(".play-button div").length&&e(".play-button").append("<div><span></span></div>"),e(".play-button div span").text(a))};if(x(),p.addEventListener("timeupdate",x),e(window).resize(function(){t()}),o===!1)d.find(".player").css("opacity",1),setTimeout(function(){d.find(".player").css("opacity",0)},3e3);else{d.find(".player").css("display","none"),e(".play-button").append("<span></span>");var T=i/1.4;i>s&&(T=s/1.4),e(".play-button span").css("margin","-"+parseInt(T/2)+"px 0 0 -"+parseInt(T/2)+"px"),e(".play-button span").css({width:parseInt(T)+"px",height:parseInt(T)+"px"})}d.find(".play-button, .pause-button").on("click",function(){m=p.currentTime>0&&0==p.paused&&0==p.ended?!1:!0,0==m?(p.currentTime>0&&0==p.ended&&e(".play-button div").hide(),e(".play-button, .pause-button").removeClass("playing"),p.pause(),w()):(e(".play-button, .pause-button").addClass("playing"),h=!0,p.play())}),d.find(".progress").on("mousedown",function(e){f=!0,1==m&&p.pause(),b=e.pageX-d.find(".progress").offset().left,u=b/y*l,p.currentTime=u}),e("body, html").on("mousemove",function(t){var n=null;if(1!=o&&(d.on("mouseover",function(){clearTimeout(n),d.find(".player").css("opacity",1)}),d.on("mouseout",function(){n=setTimeout(function(){d.find(".player").css("opacity",0)},1e3)})),1==f){p.currentTime>0?e(".play-button div").hide(200):e(".play-button div").show(200),$draggingProgress=!0;var i=0;d.find(".progress-button").width(),b=t.pageX-d.find(".progress").offset().left,0>b?(i=0,p.currentTime=0):b>y?(p.currentTime=l,i=y):(i=b,u=b/y*l,p.currentTime=u),d.find(".progress-bar").css({width:i+"px"});var s=g-d.find(".progress-button").width();0>s&&(s=0),d.find(".progress-button").css({left:s+"px"})}}),p.addEventListener("playing",function(){t()}),p.addEventListener("ended",function(){m=!1,o===!1&&""!=r&&(0===e(".play-button div").length&&e(".play-button").append("<div><span></span></div>"),e(".play-button div span").text(r),e(".play-button div").show()),e(".play-button, .pause-button").removeClass("playing")}),d.find(".volume").on("click",function(){1==p.volume?(p.volume=0,d.find(".volume").addClass("off")):(p.volume=1,d.find(".volume").removeClass("off"))}),e("body, html").on("mouseup",function(){f=!1,v=!1,$draggingProgress=!1,1==m&&p.play(),w()}),p.requestFullscreen||p.mozRequestFullScreen||p.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){p.requestFullscreen?p.requestFullscreen():p.mozRequestFullScreen?p.mozRequestFullScreen():p.webkitRequestFullScreen&&p.webkitRequestFullScreen()}),e(".link").on("click",function(){return window.parent.postMessage(window.location.href.replace("/embed/","/"),"*"),!1})})})}}(jQuery);
